{
  "taskGroups": [
    {% for task in tasks %}
    {
      "taskSpec": {
        "runnables": [
          {
            "container": {
              "imageUri": "gcr.io/uas-orchestration-engine/orchestration-images/uas-worker:latest",
              "commands": [
                "/app/{{ task.script_to_run }}"
              ]
            },
            "environment": {
              "variables": {{ task.env_vars | tojson }}
            }
          }
        ]
      },
      "taskCount": 1
      {% if dependencies[loop.index0] %}
      ,
      "dependencies": [
        {% for dep_index in dependencies[loop.index0] %}
        { "sourceTaskGroupIndex": {{ dep_index }} }{{ "," if not loop.last }}
        {% endfor %}
      ]
      {% endif %}
    }{{ "," if not loop.last }}
    {% endfor %}
  ],
  "allocationPolicy": {
    "instances": [
      {
        "policy": {
          "machineType": "n1-standard-4"
        }
      }
    ],
    "serviceAccount": {
      "email": "{{ service_account_email }}"
    }
  },
  "logsPolicy": {
    "destination": "CLOUD_LOGGING"
  }
}